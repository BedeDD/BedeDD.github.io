<!DOCTYPE html>
<html lang="en">
<head class="h-100">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onboarding Journey</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/@hotwired/stimulus/dist/stimulus.umd.js"></script>
    <script>
      (function() {
        window.Stimulus = window.Stimulus || {};
        window.Stimulus.Application = window.Stimulus.Application || class {
          static start() {
            if (!this.instance) {
              this.instance = new this();
            }
            return this.instance;
          }
        };

        const application = Stimulus.Application.start();

        application.register("onboard", class extends Stimulus.Controller {
          static targets = [ "overlay", "explanation" ];

          connect() {
            this.coordinates = [];
            this.initializeCoordinates();
            this.currentPopover = null;
          }

          initializeCoordinates() {
            this.explanationTargets.forEach((target, _index) => {
              const explainThis = document.getElementById(target.dataset.targetElement);
              const rect = explainThis.getBoundingClientRect();
              const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
              const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

              this.coordinates.push({
                top: rect.top + scrollTop,
                left: rect.left + scrollLeft,
                width: rect.width,
                height: rect.height,
                explanation: target
              });
            });
          }

          popoverConfig() {
            return {
              trigger: 'manual',
              customClass: 'onboard-popover',
              html: true,
              placement: 'auto',
              container: 'body'
            };
          }

          disposeCurrentPopover() {
            if (this.currentPopover) {
              this.currentPopover.dispose();
              this.currentPopover = null;
            }
          }

          setOverlayPosition(event) {
            const step = event.params.step;
            this.disposeCurrentPopover();

            if (parseInt(step) - 1 < this.coordinates.length) {
              const matchingCoordinate = this.coordinates[parseInt(step) - 1];
              this.overlayTarget.classList.add('active');
              this.overlayTarget.style.top = `${matchingCoordinate.top}px`;
              this.overlayTarget.style.left = `${matchingCoordinate.left}px`;
              this.overlayTarget.style.width = `${matchingCoordinate.width}px`;
              this.overlayTarget.style.height = `${matchingCoordinate.height}px`;
              this.overlayTarget.dataset.bsContent = matchingCoordinate.explanation.innerHTML;
              setTimeout(() => {
                this.currentPopover = new bootstrap.Popover(this.overlayTarget, this.popoverConfig());
                this.currentPopover.show();
              }, 300);
            } else {
              this.overlayTarget.classList.remove('active');
              console.error(`No matching explanation found for step: ${step}`);
            }
          }

          hideOnboarding() {
            this.disposeCurrentPopover();
            this.overlayTarget.classList.remove('active');
          }
        });
      })();
    </script>
    <style>
      .onboardOverlay {
        box-shadow:
          rgb(233 77 77 / 80%) 0px 0px 1px 2px,
          rgb(62 30 30 / 50%) 0px 0px 0px 5000px;
        box-sizing: content-box;
        position: absolute;
        z-index: 9999998;
        border-radius: 4px;
        transition: all .3s ease-out;
        z-index: 9998;
        pointer-events: all;
        opacity: 0;
      }

      .onboardOverlay.active {
          opacity: 1;
      }

      .onboard-popover {
          z-index: 9999;
      }
    </style>
</head>
<body class="d-flex flex-column h-100">
    <header class="p-3 mb-3 border-bottom">
      <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
          <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
            <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"></use></svg>
          </a>

          <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
            <li><a id="iverview" href="#" class="nav-link px-2 link-secondary">Overview</a></li>
            <li><a id="inventory" href="#" class="nav-link px-2 link-body-emphasis">Inventory</a></li>
            <li><a id="customers" href="#" class="nav-link px-2 link-body-emphasis">Customers</a></li>
            <li><a id="products" href="#" class="nav-link px-2 link-body-emphasis">Products</a></li>
          </ul>

          <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search">
            <input type="search" class="form-control" placeholder="Search..." aria-label="Search">
          </form>

          <div class="dropdown text-end">
            <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="https://github.com/mdo.png" alt="mdo" width="32" height="32" class="rounded-circle">
            </a>
            <ul class="dropdown-menu text-small">
              <li><a class="dropdown-item" href="#">New project...</a></li>
              <li><a class="dropdown-item" href="#">Settings</a></li>
              <li><a class="dropdown-item" href="#">Profile</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="#">Sign out</a></li>
            </ul>
          </div>
        </div>
      </div>
    </header>
    <main class="flex-shrink-0 flex-grow-1">
      <div class="container mt-5">
        
      </div>
    </main>
    <footer class="py-3 mt-auto">
      <ul class="nav justify-content-center border-bottom pb-3 mb-3">
        <li class="nav-item" id="footerHome"><a href="#" class="nav-link px-2 text-body-secondary">Home</a></li>
        <li class="nav-item" id="footerFeatures"><a href="#" class="nav-link px-2 text-body-secondary">Features</a></li>
        <li class="nav-item" id="footerPricing"><a href="#" class="nav-link px-2 text-body-secondary">Pricing</a></li>
        <li class="nav-item" id="footerFAQs"><a href="#" class="nav-link px-2 text-body-secondary">FAQs</a></li>
        <li class="nav-item" id="footerAbout"><a href="#" class="nav-link px-2 text-body-secondary">About</a></li>
      </ul>
      <p class="text-center text-body-secondary">© 2024 Benjamin Deutscher</p>
    </footer>
    <!-- das ist alles am Markup, was benötigt wird. Die buttons kommen später auch weg, die sind nur für den POC hier -->
    <div class="onboard-wrapper"  data-controller="onboard">
      <div data-onboard-target="overlay" class="onboardOverlay" data-bs-container="body" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-content="Das ist die Erklärung für den Menüpunkt 'Overview'."></div>
      <ol class="d-none">
        <!-- data-target-element = ID vom Ziel Element -->
        <li data-onboard-target="explanation" data-target-element="iverview">Das ist die Erklärung für den Menüpunkt <b>Overview!</b></li>
        <li data-onboard-target="explanation" data-target-element="inventory">Das ist die Erklärung für den Menüpunkt <b class="text-primary">Inventory!</b></li>
        <li data-onboard-target="explanation" data-target-element="customers">Das ist die Erklärung für den Menüpunkt <b class="text-success">Customers</b>!</li>
        <li data-onboard-target="explanation" data-target-element="products">Das ist die Erklärung für den Menüpunkt <b class="text-warning">Products</b>!</li>
        <li data-onboard-target="explanation" data-target-element="footerHome">Das ist die Erklärung für den Footer-Link <b class="text-warning">footerHome</b>!</li>
        <li data-onboard-target="explanation" data-target-element="footerFeatures">Das ist die Erklärung für den Footer-Link <b class="text-warning">footerFeatures</b>!</li>
        <li data-onboard-target="explanation" data-target-element="footerPricing">Das ist die Erklärung für den Footer-Link <b class="text-warning">footerPricing</b>!</li>
        <li data-onboard-target="explanation" data-target-element="footerFAQs">Das ist die Erklärung für den Footer-Link <b class="text-warning">footerFAQs</b>!</li>
        <li data-onboard-target="explanation" data-target-element="footerAbout">Das ist die Erklärung für den Footer-Link <b class="text-warning">footerAbout</b>!</li>
      </ol>
      <div class="d-flex flex-row gap-3">
        <button type="button"class="mt-5" data-action="onboard#setOverlayPosition" data-onboard-step-param="1">Show Step 1</button>
        <button type="button"class="mt-5" data-action="onboard#setOverlayPosition" data-onboard-step-param="2">Show Step 2</button>
        <button type="button"class="mt-5" data-action="onboard#setOverlayPosition" data-onboard-step-param="3">Show Step 3</button>
        <button type="button"class="mt-5" data-action="onboard#setOverlayPosition" data-onboard-step-param="4">Show Step 4</button>
        <button type="button"class="mt-5" data-action="onboard#setOverlayPosition" data-onboard-step-param="5">Show Step 5</button>
        <button type="button"class="mt-5" data-action="onboard#setOverlayPosition" data-onboard-step-param="6">Show Step 6</button>
        <button type="button"class="mt-5" data-action="onboard#setOverlayPosition" data-onboard-step-param="7">Show Step 7</button>
        <button type="button"class="mt-5" data-action="onboard#setOverlayPosition" data-onboard-step-param="8">Show Step 8</button>
        <button type="button"class="mt-5" data-action="onboard#setOverlayPosition" data-onboard-step-param="9">Show Step 9</button>
        <button type="button"class="mt-5" data-action="onboard#hideOnboarding">Hide Onboarding</button>
      </div>
    </div>
</body>
</html>
